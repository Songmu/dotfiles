# =============================================================================
# tmux.conf - Converted from .screenrc
# Location: ~/.config/tmux/tmux.conf (XDG compliant, tmux 3.1+)
# =============================================================================

# -----------------------------------------------------------------------------
# Basic Settings
# -----------------------------------------------------------------------------

# Prefix key: Ctrl+Q (same as screen's escape ^Qq)
unbind C-b
set -g prefix C-q
bind C-q send-prefix

# Disable startup message (screen: startup_message off)
# tmux doesn't show startup message by default

# Disable visual bell (screen: vbell off)
set -g visual-bell off
set -g bell-action none

# Message display time (screen: msgminwait 0)
set -g display-time 1000

# Scrollback buffer (screen: defscrollback 10000)
set -g history-limit 10000

# Terminal settings (screen: term screen.xterm-256color, truecolor on)
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Default shell (screen: shell zsh)
set -g default-shell /bin/zsh

# Enable mouse support
set -g mouse on

# Faster escape time
set -sg escape-time 0

# Window/pane index starts from 0
set -g base-index 0
set -g pane-base-index 0

# Auto rename window (screen: shelltitle)
set -g automatic-rename on
set -g automatic-rename-format "#{pane_current_command}"

# Altscreen (screen: altscreen on)
set -g alternate-screen on

# -----------------------------------------------------------------------------
# Status Line (screen: hardstatus alwayslastline)
# -----------------------------------------------------------------------------

set -g status on
set -g status-position bottom
set -g status-interval 1

# Status line style (similar to screen's hardstatus)
set -g status-style "bg=default,fg=default"
set -g status-left ""
set -g status-right ""

# Window list format (screen: hardstatus "%`%-w%{=d 7;4}%n %t%{-}%+w")
set -g window-status-format "#I #W"
set -g window-status-current-format "#[reverse]#I #W#[default]"
set -g window-status-separator " "

# -----------------------------------------------------------------------------
# Key Bindings - Vim-style Pane Navigation
# -----------------------------------------------------------------------------

# Unbind default x (screen: bind x)
unbind x

# Pane navigation (screen: bind j/k/h/l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split window (screen: bind s split, bind v split -v)
# Note: screen's split is horizontal (top/bottom), tmux's split-window -v is also horizontal
bind s split-window -v -c "#{pane_current_path}"
bind v split-window -h -c "#{pane_current_path}"

# Equalize pane sizes (screen: bind = resize -v =)
bind = select-layout even-vertical
bind | select-layout even-horizontal

# -----------------------------------------------------------------------------
# Operate Mode (screen: bind w command -c operate)
# Using repeat mode with repeat-time for continuous operation
# -----------------------------------------------------------------------------

set -g repeat-time 1000

# Window navigation (repeatable)
bind -r p previous-window
bind -r n next-window

# Pane navigation in operate mode style (repeatable)
bind -r C-h select-pane -L
bind -r C-j select-pane -D
bind -r C-k select-pane -U
bind -r C-l select-pane -R

# Resize panes (screen: +/- for vertical, >< for horizontal)
bind -r + resize-pane -U 1
bind -r - resize-pane -D 1
bind -r > resize-pane -R 1
bind -r < resize-pane -L 1

# Larger resize steps with Shift
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# -----------------------------------------------------------------------------
# Layout Operations (screen: bind y command -c layout)
# Auto-creates panes if needed, then applies layout
# Matches .screenrc.layout: 0=full, 1=threepain, 2=vertical
# -----------------------------------------------------------------------------

# Layout preset selection with prefix + y followed by key
bind y switch-client -T layout

# Layout mode bindings
bind -T layout c new-window \; display-message "New window created"
bind -T layout X kill-window \; display-message "Window killed"
bind -T layout A command-prompt -I "#W" "rename-window '%%'"

# Layout presets with auto pane creation (matching .screenrc.layout)
# 0: full - single pane
bind -T layout 0 run-shell 'tmux kill-pane -a' \; display-message "Layout 0: full"

# 1: threepain - left main (65%), right top/bottom (35%)
bind -T layout 1 run-shell ' \
    tmux kill-pane -a 2>/dev/null; \
    tmux split-window -h -p 35; \
    tmux split-window -v -t 1; \
    tmux select-pane -t 0' \; display-message "Layout 1: threepain"

# 2: vertical - left/right 2 panes
bind -T layout 2 run-shell ' \
    tmux kill-pane -a 2>/dev/null; \
    tmux split-window -h; \
    tmux select-pane -t 0' \; display-message "Layout 2: vertical"

# Cycle through layouts (existing panes only)
bind -T layout n next-layout \; switch-client -T layout
bind -T layout p previous-layout \; switch-client -T layout
bind -T layout Space next-layout \; switch-client -T layout

# Quick access without layout mode
bind Space next-layout

# -----------------------------------------------------------------------------
# Clipboard / Copy Mode (screen: bufferfile, pbcopy integration)
# -----------------------------------------------------------------------------

# Use vi mode in copy mode
set -g mode-keys vi

# Copy to system clipboard (macOS)
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# Paste from tmux buffer (screen: bind p for paste to pbcopy)
bind P paste-buffer
bind p run-shell "tmux save-buffer - | pbcopy" \; display-message "Copied to clipboard"

# Enter copy mode
bind [ copy-mode
bind Escape copy-mode

# -----------------------------------------------------------------------------
# Additional Useful Bindings
# -----------------------------------------------------------------------------

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded"

# Kill pane without confirmation
bind q kill-pane

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Swap panes
bind -r '{' swap-pane -U
bind -r '}' swap-pane -D

# Zoom pane toggle
bind z resize-pane -Z

# Clear screen and history
bind C-l send-keys C-l \; run-shell "sleep 0.1" \; clear-history
