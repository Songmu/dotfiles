# =============================================================================
# tmux.conf - Converted from .screenrc
# Location: ~/.config/tmux/tmux.conf (XDG compliant, tmux 3.1+)
# =============================================================================

# -----------------------------------------------------------------------------
# TPM (Tmux Plugin Manager)
# -----------------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-yank'

# -----------------------------------------------------------------------------
# Basic Settings
# -----------------------------------------------------------------------------

# Prefix key: Ctrl+Q (same as screen's escape ^Qq)
unbind C-b
set -g prefix C-q
bind C-q send-prefix

# Disable visual bell (screen: vbell off)
set -g visual-bell off
set -g bell-action none

# Scrollback buffer (screen: defscrollback 10000)
set -g history-limit 10000

# Terminal settings (screen: term screen.xterm-256color, truecolor on)
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Default shell (screen: shell zsh)
set -g default-shell /bin/zsh

# Enable mouse support
set -g mouse on

# Window/pane index starts from 0
set -g base-index 0
set -g pane-base-index 0

# Auto rename window (screen: shelltitle)
set -g automatic-rename on
set -g automatic-rename-format "#{pane_current_command}"

# Altscreen (screen: altscreen on)
set -g alternate-screen on

# -----------------------------------------------------------------------------
# Status Line (screen: hardstatus alwayslastline)
# -----------------------------------------------------------------------------

set -g status on
set -g status-position bottom
set -g status-interval 1

# Status line style (similar to screen's hardstatus)
set -g status-style "bg=default,fg=default"
set -g status-left ""
set -g status-right ""

# Window list format (screen: hardstatus "%`%-w%{=d 7;4}%n %t%{-}%+w")
set -g window-status-format "#I #W"
set -g window-status-current-format "#[reverse]#I #W#[default]"
set -g window-status-separator " "

# -----------------------------------------------------------------------------
# Key Bindings (additional to tmux-pain-control)
# -----------------------------------------------------------------------------

# Unbind default x (screen: bind x)
unbind x

# tmux-pain-control provides: h/j/k/l navigation, s/v split, H/J/K/L resize

# Equalize pane sizes (screen: bind = resize -v =)
bind = select-layout even-vertical
bind | select-layout even-horizontal

# Operate mode style (repeatable navigation)
set -g repeat-time 1000
bind -r p previous-window
bind -r n next-window

# Resize panes (screen: +/- for vertical, >< for horizontal)
bind -r + resize-pane -U 1
bind -r - resize-pane -D 1
bind -r > resize-pane -R 1
bind -r < resize-pane -L 1

# -----------------------------------------------------------------------------
# Layout Operations (screen: bind y command -c layout)
# Matches .screenrc.layout: 0=full, 1=threepain, 2=vertical
# -----------------------------------------------------------------------------

bind y switch-client -T layout

bind -T layout c new-window \; display-message "New window created"
bind -T layout X kill-window \; display-message "Window killed"
bind -T layout A command-prompt -I "#W" "rename-window '%%'"

# 0: full - single pane
bind -T layout 0 run-shell 'tmux kill-pane -a' \; display-message "Layout 0: full"

# 1: threepain - left main (65%), right top/bottom (35%)
bind -T layout 1 run-shell ' \
    tmux kill-pane -a 2>/dev/null; \
    tmux split-window -h -p 35; \
    tmux split-window -v -t 1; \
    tmux select-pane -t 0' \; display-message "Layout 1: threepain"

# 2: vertical - left/right 2 panes
bind -T layout 2 run-shell ' \
    tmux kill-pane -a 2>/dev/null; \
    tmux split-window -h; \
    tmux select-pane -t 0' \; display-message "Layout 2: vertical"

bind -T layout n next-layout \; switch-client -T layout
bind -T layout p previous-layout \; switch-client -T layout
bind -T layout Space next-layout \; switch-client -T layout

bind Space next-layout

# -----------------------------------------------------------------------------
# Copy Mode (tmux-yank handles clipboard, add screen-style bindings)
# -----------------------------------------------------------------------------

set -g mode-keys vi

# Rectangle selection (screen: c/C)
bind -T copy-mode-vi c send-keys -X rectangle-toggle
bind -T copy-mode-vi C send-keys -X rectangle-toggle

bind [ copy-mode
bind Escape copy-mode

# -----------------------------------------------------------------------------
# Additional Bindings
# -----------------------------------------------------------------------------

bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded"
bind q kill-pane
bind c new-window -c "#{pane_current_path}"
bind -r '{' swap-pane -U
bind -r '}' swap-pane -D
bind z resize-pane -Z
bind C-l send-keys C-l \; run-shell "sleep 0.1" \; clear-history

# -----------------------------------------------------------------------------
# Initialize TPM (keep at the bottom)
# -----------------------------------------------------------------------------

run '~/.tmux/plugins/tpm/tpm'
